--- /tmp/UpdateProcessor.php.orig	2025-12-26 00:17:00
+++ web/core/modules/update/src/UpdateProcessor.php	2025-12-26 00:08:07
@@ -181,8 +181,47 @@
     if (empty($this->failed[$fetch_url_base]) || $this->failed[$fetch_url_base] < $max_fetch_attempts) {
       $data = $this->updateFetcher->fetchProjectData($project, $site_key);
     }
+    
+    // DIAGNOSTIC: Log fetch state for drupal core to diagnose CI failures
+    $is_drupal_core = ($project_name === 'drupal');
+    if ($is_drupal_core) {
+      $log_dir = DRUPAL_ROOT . '/../logs';
+      if (!is_dir($log_dir)) {
+        @mkdir($log_dir, 0755, TRUE);
+      }
+      $log_file = $log_dir . '/update-fetch-diagnosis-' . date('Y-m-d-H-i-s') . '.log';
+      $log = "=== UpdateProcessor::processFetchTask() for drupal ===\n";
+      $log .= "Time: " . date('c') . "\n";
+      $log .= "Fetch URL base: {$fetch_url_base}\n";
+      $log .= "Raw data received: " . (!empty($data) ? 'YES (' . strlen($data) . ' bytes)' : 'NO') . "\n";
+      if (!empty($data)) {
+        $log .= "Raw XML contains <project_status>: " . (strpos($data, '<project_status>') !== FALSE ? 'YES' : 'NO') . "\n";
+        if (strpos($data, '<project_status>') !== FALSE) {
+          // Extract the value
+          if (preg_match('/<project_status>([^<]+)<\/project_status>/', $data, $matches)) {
+            $log .= "project_status value in XML: {$matches[1]}\n";
+          }
+        }
+      }
+    }
+    
     if (!empty($data)) {
       $available = $this->parseXml($data);
+      
+      // DIAGNOSTIC: Continue logging after parse
+      if ($is_drupal_core) {
+        $log .= "parseXml() returned data: " . (!empty($available) ? 'YES' : 'NO') . "\n";
+        if (!empty($available)) {
+          $log .= "Parsed data has project_status: " . (isset($available['project_status']) ? 'YES' : 'NO') . "\n";
+          if (isset($available['project_status'])) {
+            $log .= "Parsed project_status value: {$available['project_status']}\n";
+          } else {
+            $log .= "WARNING: project_status missing after parseXml()!\n";
+            $log .= "Available keys: " . implode(', ', array_keys($available)) . "\n";
+          }
+        }
+      }
+      
       // @todo Purge release data we don't need. See
       //   https://www.drupal.org/node/238950.
       if (!empty($available)) {
@@ -192,6 +231,13 @@
     }
     else {
       $available['project_status'] = 'not-fetched';
+      
+      // DIAGNOSTIC: Log fetch failure
+      if ($is_drupal_core) {
+        $log .= "Fetch failed - no data received\n";
+        $log .= "Setting project_status to: not-fetched\n";
+      }
+      
       if (empty($this->failed[$fetch_url_base])) {
         $this->failed[$fetch_url_base] = 1;
       }
@@ -199,6 +245,17 @@
         $this->failed[$fetch_url_base]++;
       }
     }
+    
+    // DIAGNOSTIC: Log final state before cache write
+    if ($is_drupal_core) {
+      $log .= "Final available array has project_status: " . (isset($available['project_status']) ? 'YES' : 'NO') . "\n";
+      if (isset($available['project_status'])) {
+        $log .= "Final project_status value: {$available['project_status']}\n";
+      }
+      $log .= "Success: " . ($success ? 'TRUE' : 'FALSE') . "\n";
+      $log .= "=== END DIAGNOSTIC ===\n";
+      @file_put_contents($log_file, $log);
+    }
 
     $frequency = $this->updateSettings->get('check.interval_days');
     $available['last_fetch'] = $this->time->getRequestTime() + $request_time_difference;
